USE [baseWebSupervisor]
GO
/****** Object:  FullTextCatalog [Busquedas]    Script Date: 30/04/2016 1:18:27 ******/
CREATE FULLTEXT CATALOG [Busquedas]WITH ACCENT_SENSITIVITY = OFF
AS DEFAULT

GO
/****** Object:  Table [dbo].[Tabla_Ano]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Ano](
	[id_Ano] [int] NOT NULL CONSTRAINT [DF_Tabla_Ano_id_Ano]  DEFAULT (NEXT VALUE FOR [secuancia_Ano]),
	[ano] [nvarchar](50) NULL,
	[etiquetaAno] [int] NULL,
 CONSTRAINT [PK_Tabla_Ano] PRIMARY KEY CLUSTERED 
(
	[id_Ano] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_BuquedasEjercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_BuquedasEjercicios](
	[id_Ejercicio] [int] NOT NULL,
	[etiquetaTema] [nvarchar](150) NULL,
	[etiquetaMateria] [nvarchar](150) NULL,
	[etiquetaColegio] [nvarchar](150) NULL,
	[etiquetaProfesor] [nvarchar](150) NULL,
	[etiquetaAno] [nvarchar](150) NULL,
	[id_TipoInstitucion] [int] NULL,
 CONSTRAINT [PK_Tabla_BuquedaEjercicios] PRIMARY KEY CLUSTERED 
(
	[id_Ejercicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Colegio]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Colegio](
	[id_Colegio] [int] NOT NULL CONSTRAINT [DF_Tabla_Colegio_id_Colegio]  DEFAULT (NEXT VALUE FOR [secuancia_Colegio]),
	[colegio] [nvarchar](50) NULL,
	[etiquetaColegio] [int] NULL,
 CONSTRAINT [PK_Tabla_Colegio] PRIMARY KEY CLUSTERED 
(
	[id_Colegio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_DatosExtraUsuario]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_DatosExtraUsuario](
	[id_Usuario] [int] NOT NULL,
	[ipAddress] [nvarchar](20) NULL,
	[bloqueoUsuario] [bit] NOT NULL,
	[ofertaProximaCarga] [int] NULL,
	[codigoBloqueo] [int] NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_DatosUsuario]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_DatosUsuario](
	[id_Usuario] [int] NOT NULL,
	[telefono] [nvarchar](20) NULL,
	[modeloTelefono] [nvarchar](20) NULL,
	[skype] [nvarchar](30) NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_DuracionProductos]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_DuracionProductos](
	[id_Empresa] [int] NOT NULL,
	[duracionVideos] [int] NOT NULL,
	[duracionEjercicios] [int] NOT NULL,
	[precioVideo] [decimal](18, 2) NULL,
	[precioEjercicio] [decimal](18, 2) NULL,
	[precioExplicacion] [decimal](18, 2) NULL,
	[precioImpresion] [decimal](18, 2) NULL,
	[ejerciciosCompradosHabitue] [int] NULL,
	[recargaHabitue] [decimal](18, 2) NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Ejercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Ejercicios](
	[id_Ejercicio] [int] NOT NULL CONSTRAINT [DF_Tabla_Ejercicios_id_Ejercicio]  DEFAULT (NEXT VALUE FOR [secuancia_TablaEjercicios]),
	[Titulo] [nvarchar](50) NOT NULL,
 CONSTRAINT [PK_Tabla_Ejercicios] PRIMARY KEY CLUSTERED 
(
	[id_Ejercicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Empresa]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Empresa](
	[id_Empresa] [int] NOT NULL CONSTRAINT [DF_Tabla_Empresa_id_Empresa]  DEFAULT (NEXT VALUE FOR [secuancia_TablaEmpresa]),
	[empresa] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_Tabla_Empresa] PRIMARY KEY CLUSTERED 
(
	[id_Empresa] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_EnunciadoEjercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_EnunciadoEjercicios](
	[id_Ejercicio] [int] NOT NULL,
	[enunciadoMath] [nvarchar](max) NULL,
	[enunciadoLimpio] [nvarchar](max) NULL,
 CONSTRAINT [PK_Tabla_EnunciadoEjercicios] PRIMARY KEY CLUSTERED 
(
	[id_Ejercicio] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Materia]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Materia](
	[id_Materia] [int] NOT NULL CONSTRAINT [DF_Tabla_Materia_id_Materia]  DEFAULT (NEXT VALUE FOR [secuancia_Materia]),
	[materia] [nvarchar](50) NULL,
	[etiquetaMateria] [int] NULL,
 CONSTRAINT [PK_Tabla_Materia] PRIMARY KEY CLUSTERED 
(
	[id_Materia] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_MisEjercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_MisEjercicios](
	[id_CompraEjercicioExplicaicones] [int] NOT NULL CONSTRAINT [DF_Tabla_MisEjercicios_id_CompraEjercicioExplicaicones]  DEFAULT (NEXT VALUE FOR [secuancia_MisEjercicios]),
	[id_Ejercicio] [int] NOT NULL,
	[ejercicio] [bit] NOT NULL,
	[explicacion] [bit] NOT NULL,
	[venvimiento] [int] NOT NULL,
	[fechaVencimiento] [datetime] NOT NULL,
	[id_Usuario] [int] NOT NULL,
 CONSTRAINT [PK_Tabla_MisEjercicios] PRIMARY KEY CLUSTERED 
(
	[id_CompraEjercicioExplicaicones] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_MisExplicaciones]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_MisExplicaciones](
	[id_CompraVideos] [int] NULL CONSTRAINT [DF_Tabla_MisExplicaciones_id_CompraVideos]  DEFAULT (NEXT VALUE FOR [secuancia_MisExplicaciones]),
	[id_Ejercicio] [int] NULL,
	[video] [bit] NULL,
	[vencimiento] [int] NULL,
	[fechaVencimiento] [datetime] NULL,
	[id_Usuario] [int] NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Movimientos]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Movimientos](
	[id_Movimiento] [int] NOT NULL CONSTRAINT [DF_Tabla_Movimientos_id_Movimiento]  DEFAULT (NEXT VALUE FOR [secuancia_TablaMovimientos]),
	[id_Usuario] [int] NOT NULL,
	[id_TipoMovimiento] [int] NOT NULL,
	[debe] [decimal](18, 2) NULL,
	[haber] [decimal](18, 2) NULL,
	[fechaMovimiento] [date] NOT NULL,
 CONSTRAINT [PK_Tabla_Movimientos_1] PRIMARY KEY CLUSTERED 
(
	[id_Movimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Ofertas]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Ofertas](
	[id_Empresa] [int] NOT NULL,
	[oferta_1PrestamoSOS] [bit] NULL,
	[oferta_2Registro] [bit] NULL,
	[oferta_3ProximaCarga] [bit] NULL,
	[oferta_4AumentoCarga] [bit] NULL,
	[oferta_5RegaloCarga] [bit] NULL,
	[oferta_6DosXUno] [bit] NULL,
	[oferta_7DosXUnoIgualProducto] [bit] NULL,
	[oferta_8Gratis] [bit] NULL,
	[oferta_9DescuentoSegundo] [bit] NULL,
	[oferta_10BonificaciónHabitue] [bit] NULL,
	[oferta_11AumentoDiasCompras] [bit] NULL,
	[oferta_12AumentoDiasTodasCompras] [bit] NULL,
	[oferta_13DescuentoCompra] [bit] NULL,
	[oferta_14ImpresionGratis] [bit] NULL,
	[oferta_15VideosGratis] [bit] NULL,
	[oferta_16EjerciciosGratis] [bit] NULL,
	[oferta_17ExplicacionesGratis] [bit] NULL,
	[oferta_18] [bit] NULL,
	[oferta_19] [bit] NULL,
	[oferta_20] [bit] NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_PedidoEjercicioVideo]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_PedidoEjercicioVideo](
	[id_PedidoEjercicioVideo] [int] NOT NULL,
	[id_Usuario] [int] NOT NULL,
	[id_Administrador] [int] NOT NULL,
	[fechaPedidoEjercicioVideo] [datetime] NULL,
	[fichaEjercicioVideo] [nvarchar](50) NULL,
	[enunciadoEjercicioVideoMATH] [nvarchar](50) NULL,
	[adjuntoEjercicioVideo] [nvarchar](50) NULL,
	[realizadoOKPedidoEjercicioVideo] [bit] NULL,
 CONSTRAINT [PK_Tabla_PedidoEjercicioVideo] PRIMARY KEY CLUSTERED 
(
	[id_PedidoEjercicioVideo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_PedidoExplicacion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_PedidoExplicacion](
	[id_PedidoExplicacion] [int] NOT NULL,
	[id_Usuario] [int] NOT NULL,
	[fechaPedidoExplicacion] [datetime] NULL,
	[id_Administrador] [int] NOT NULL,
	[realizadoOK] [bit] NULL,
 CONSTRAINT [PK_Tabla_PedidoExplicacion] PRIMARY KEY CLUSTERED 
(
	[id_PedidoExplicacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_PreguntaClientes]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_PreguntaClientes](
	[id_PreguntaUsuario] [int] NOT NULL CONSTRAINT [DF_Tabla_PreguntaClientes_id_PreguntaUsuario]  DEFAULT (NEXT VALUE FOR [secuancia_PreguntaUsuario]),
	[PreguntaUsuario] [nvarchar](max) NOT NULL,
	[id_Empresa] [int] NOT NULL,
	[fechaComentario] [datetime] NOT NULL,
	[correoCliente] [nvarchar](30) NOT NULL,
 CONSTRAINT [PK_Tabla_PreguntaUsuario] PRIMARY KEY CLUSTERED 
(
	[id_PreguntaUsuario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Profesor]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Profesor](
	[id_Profesor] [int] NOT NULL,
	[profesor] [nvarchar](50) NULL,
	[etiquetaProfesor] [int] NULL,
 CONSTRAINT [PK_Tabla_Profesor] PRIMARY KEY CLUSTERED 
(
	[id_Profesor] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_TarjetaPrepaga]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_TarjetaPrepaga](
	[id_Tarjeta] [int] NOT NULL CONSTRAINT [DF_Tabla_TarjetaPrepaga_id_Tarjeta]  DEFAULT (NEXT VALUE FOR [secuancia_TarjetaPrepaga]),
	[codigoTarjeta] [nvarchar](50) NULL,
	[valorTarjeta] [decimal](18, 2) NULL,
	[vencimientoTarjeta] [datetime] NULL,
	[bloqueoTarjeta] [bit] NULL,
	[id_Empresa] [int] NULL,
 CONSTRAINT [PK_Tabla_Tarjeta_Prepaga] PRIMARY KEY CLUSTERED 
(
	[id_Tarjeta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Tema]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Tema](
	[id_Tema] [int] NOT NULL CONSTRAINT [DF_Tabla_Tema_id_Tema]  DEFAULT (NEXT VALUE FOR [secuancia_Tema]),
	[tema] [nvarchar](50) NOT NULL,
	[etiquetaTema] [int] NOT NULL,
 CONSTRAINT [PK_Tabla_Tema] PRIMARY KEY CLUSTERED 
(
	[id_Tema] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_TipoIntitucion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_TipoIntitucion](
	[id_TipoInstitucion] [int] NOT NULL,
	[tipoInstitucion] [nvarchar](50) NULL,
 CONSTRAINT [PK_Tabla_TipoIntitucion] PRIMARY KEY CLUSTERED 
(
	[id_TipoInstitucion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_TipoMovimientos]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_TipoMovimientos](
	[id_TipoMovimiento] [int] NOT NULL,
	[tipoMovimiento] [nvarchar](30) NULL,
 CONSTRAINT [PK_Tabla_Movimientos] PRIMARY KEY CLUSTERED 
(
	[id_TipoMovimiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_UbicacionEjercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_UbicacionEjercicios](
	[id_Ejercicio] [int] NOT NULL,
	[ubicacionVisible] [nvarchar](50) NULL,
	[ubicacionImprimible] [nvarchar](50) NULL,
	[ubicacionVideo] [nvarchar](50) NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_Usuario]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_Usuario](
	[id_Usuario] [int] NOT NULL CONSTRAINT [DF_Tabla_Usuario_id_Usuario]  DEFAULT (NEXT VALUE FOR [secuancia_TablaUsuario]),
	[nick] [nvarchar](10) NOT NULL,
	[password] [nvarchar](10) NOT NULL,
	[correo] [nvarchar](30) NOT NULL,
	[id_Empresa] [int] NOT NULL,
 CONSTRAINT [PK_Tabla_Usuario] PRIMARY KEY CLUSTERED 
(
	[id_Usuario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_UsuarioCredito]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_UsuarioCredito](
	[id_Usuario] [int] NOT NULL,
	[creditoUsuario] [decimal](18, 2) NULL,
	[prestamoReal] [decimal](18, 2) NULL,
	[prestamoSOS] [bit] NULL
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tabla_ValorOfertas]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tabla_ValorOfertas](
	[id_Empresa] [int] NOT NULL,
	[oferta_1ValorPrestamoSOS] [decimal](8, 2) NULL,
	[oferta_2ValorRegistro] [decimal](8, 2) NULL,
	[oferta_3ValorProximaCarga] [int] NULL,
	[oferta_4ValorAumentoCarga] [int] NULL,
	[oferta_5ValorRegaloCarga] [decimal](8, 2) NULL,
	[oferta_6ValorDosXUno] [bit] NULL,
	[oferta_7ValorDosXUnoigualProducto] [bit] NULL,
	[oferta_8ValorGratis] [int] NULL,
	[oferta_9ValorDescuentoSegundo] [decimal](8, 2) NULL,
	[oferta_10ValorBonificacionHabitue] [int] NULL,
	[oferta_11ValorAumentoDiasCompras] [int] NULL,
	[oferta_12ValorAumentoDiasTodasCompras] [int] NULL,
	[oferta_13ValorDescuentoCompra] [decimal](8, 2) NULL,
	[oferta_14ValorImpresionGratis] [int] NULL,
	[oferta_15ValorVideoGratis] [int] NULL,
	[oferta_16ValorEjerciciosGratis] [int] NULL,
	[oferta_17ValorExplicacionesGratis] [int] NULL,
	[oferta_18Valor] [decimal](8, 2) NULL,
	[oferta_19Valor] [decimal](8, 2) NULL,
	[oferta_20Valor] [decimal](8, 2) NULL
) ON [PRIMARY]

GO
/****** Object:  View [dbo].[Vista_ActivacionUsuarioWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_ActivacionUsuarioWeb]
AS
SELECT        dbo.Tabla_Empresa.id_Empresa, dbo.Tabla_Usuario.id_Usuario, dbo.Tabla_Usuario.nick, dbo.Tabla_DatosExtraUsuario.codigoBloqueo, dbo.Tabla_DatosExtraUsuario.bloqueoUsuario
FROM            dbo.Tabla_Usuario INNER JOIN
                         dbo.Tabla_Empresa ON dbo.Tabla_Usuario.id_Empresa = dbo.Tabla_Empresa.id_Empresa INNER JOIN
                         dbo.Tabla_DatosExtraUsuario ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_DatosExtraUsuario.id_Usuario

GO
/****** Object:  View [dbo].[Vista_BusquedaEjercicioDatalistWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_BusquedaEjercicioDatalistWeb]
AS
SELECT        dbo.Tabla_Ejercicios.id_Ejercicio, dbo.Tabla_Ejercicios.Titulo, dbo.Tabla_BusquedaEjercicios.etiquetaTema, dbo.Tabla_BusquedaEjercicios.etiquetaMateria, dbo.Tabla_BusquedaEjercicios.etiquetaColegio, 
                         dbo.Tabla_BusquedaEjercicios.etiquetaProfesor, dbo.Tabla_BusquedaEjercicios.etiquetaAno, dbo.Tabla_BusquedaEjercicios.id_TipoInstitucion
FROM            dbo.Tabla_BusquedaEjercicios INNER JOIN
                         dbo.Tabla_Ejercicios ON dbo.Tabla_BusquedaEjercicios.id_Ejericicio = dbo.Tabla_Ejercicios.id_Ejercicio

GO
/****** Object:  View [dbo].[Vista_CreditoUsuarioWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_CreditoUsuarioWeb]
AS
SELECT        dbo.Tabla_Usuario.id_Usuario, dbo.Tabla_UsuarioCredito.creditoUsuario
FROM            dbo.Tabla_Usuario INNER JOIN
                         dbo.Tabla_UsuarioCredito ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_UsuarioCredito.id_Usuario

GO
/****** Object:  View [dbo].[Vista_LogueoUsuariosWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_LogueoUsuariosWeb]
AS
SELECT        dbo.Tabla_Usuario.password, dbo.Tabla_DatosExtraUsuario.bloqueoUsuario, dbo.Tabla_Usuario.id_Usuario, dbo.Tabla_Usuario.nick, dbo.Tabla_Usuario.id_Empresa, dbo.Tabla_Usuario.correo, 
                         dbo.Tabla_DatosUsuario.telefono
FROM            dbo.Tabla_Usuario INNER JOIN
                         dbo.Tabla_DatosExtraUsuario ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_DatosExtraUsuario.id_Usuario INNER JOIN
                         dbo.Tabla_DatosUsuario ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_DatosUsuario.id_Usuario

GO
/****** Object:  View [dbo].[Vista_MostrarEnunciadoDatalistWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_MostrarEnunciadoDatalistWeb]
AS
SELECT        dbo.Tabla_UbicacionEjercicios.ubicacionVideo, dbo.Tabla_Ejercicios.id_Ejercicio
FROM            dbo.Tabla_Ejercicios INNER JOIN
                         dbo.Tabla_UbicacionEjercicios ON dbo.Tabla_Ejercicios.id_Ejercicio = dbo.Tabla_UbicacionEjercicios.id_Ejercicio
GROUP BY dbo.Tabla_UbicacionEjercicios.ubicacionVideo, dbo.Tabla_Ejercicios.id_Ejercicio

GO
/****** Object:  View [dbo].[Vista_MostrarListadoDeEjercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_MostrarListadoDeEjercicios]
AS
SELECT        dbo.Tabla_Ejercicios.id_Ejercicio, dbo.Tabla_UbicacionEjercicios.ubicacionVisible, dbo.Tabla_UbicacionEjercicios.ubicacionImprimible, dbo.Tabla_UbicacionEjercicios.ubicacionVideo, 
                         dbo.Tabla_EnunciadoEjercicios.enunciadoMath, dbo.Tabla_EnunciadoEjercicios.enunciadoLimpio
FROM            dbo.Tabla_Ejercicios INNER JOIN
                         dbo.Tabla_UbicacionEjercicios ON dbo.Tabla_Ejercicios.id_Ejercicio = dbo.Tabla_UbicacionEjercicios.id_Ejercicio INNER JOIN
                         dbo.Tabla_EnunciadoEjercicios ON dbo.Tabla_Ejercicios.id_Ejercicio = dbo.Tabla_EnunciadoEjercicios.id_Ejercicio

GO
/****** Object:  View [dbo].[Vista_PanelControlUsuarioWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_PanelControlUsuarioWeb]
AS
SELECT        dbo.Tabla_Usuario.id_Usuario, dbo.Tabla_Usuario.password, dbo.Tabla_Usuario.correo, dbo.Tabla_DatosUsuario.telefono, dbo.Tabla_DatosUsuario.modeloTelefono, dbo.Tabla_DatosUsuario.skype, 
                         dbo.Tabla_Usuario.id_Empresa
FROM            dbo.Tabla_Usuario INNER JOIN
                         dbo.Tabla_DatosUsuario ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_DatosUsuario.id_Usuario

GO
/****** Object:  View [dbo].[Vista_PanelSaldoUsuarioWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_PanelSaldoUsuarioWeb]
AS
SELECT        dbo.Tabla_Usuario.id_Usuario, dbo.Tabla_Movimientos.debe, dbo.Tabla_Movimientos.haber, dbo.Tabla_TipoMovimientos.tipoMovimiento, dbo.Tabla_Movimientos.fechaMovimiento, 
                         dbo.Tabla_Movimientos.id_Movimiento
FROM            dbo.Tabla_Movimientos INNER JOIN
                         dbo.Tabla_Usuario ON dbo.Tabla_Movimientos.id_Usuario = dbo.Tabla_Usuario.id_Usuario INNER JOIN
                         dbo.Tabla_TipoMovimientos ON dbo.Tabla_Movimientos.id_TipoMovimiento = dbo.Tabla_TipoMovimientos.id_TipoMovimiento

GO
/****** Object:  View [dbo].[Vista_RecuperarContraseñaWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[Vista_RecuperarContraseñaWeb]
AS
SELECT        dbo.Tabla_Usuario.correo, dbo.Tabla_Usuario.id_Empresa, dbo.Tabla_DatosExtraUsuario.bloqueoUsuario, dbo.Tabla_Usuario.nick, dbo.Tabla_Usuario.password, dbo.Tabla_DatosUsuario.telefono
FROM            dbo.Tabla_Usuario INNER JOIN
                         dbo.Tabla_DatosExtraUsuario ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_DatosExtraUsuario.id_Usuario INNER JOIN
                         dbo.Tabla_DatosUsuario ON dbo.Tabla_Usuario.id_Usuario = dbo.Tabla_DatosUsuario.id_Usuario

GO
/****** Object:  FullTextIndex     Script Date: 30/04/2016 1:18:27 ******/
CREATE FULLTEXT INDEX ON [dbo].[Tabla_BuquedasEjercicios](
[etiquetaAno] LANGUAGE 'Spanish', 
[etiquetaColegio] LANGUAGE 'Spanish', 
[etiquetaMateria] LANGUAGE 'Spanish', 
[etiquetaProfesor] LANGUAGE 'Spanish', 
[etiquetaTema] LANGUAGE 'Spanish')
KEY INDEX [PK_Tabla_BuquedaEjercicios]ON ([Busquedas], FILEGROUP [PRIMARY])
WITH (CHANGE_TRACKING = AUTO, STOPLIST = OFF)


GO
/****** Object:  FullTextIndex     Script Date: 30/04/2016 1:18:27 ******/
CREATE FULLTEXT INDEX ON [dbo].[Tabla_EnunciadoEjercicios](
[enunciadoLimpio] LANGUAGE 'Spanish', 
[enunciadoMath] LANGUAGE 'Spanish')
KEY INDEX [PK_Tabla_EnunciadoEjercicios]ON ([Busquedas], FILEGROUP [PRIMARY])
WITH (CHANGE_TRACKING = AUTO, STOPLIST = OFF)


GO
ALTER TABLE [dbo].[Tabla_PedidoEjercicioVideo] ADD  CONSTRAINT [DF_Tabla_PedidoEjercicioVideo_id_PedidoEjercicioVideo]  DEFAULT (NEXT VALUE FOR [secuancia_PedidoEjercicioVideo]) FOR [id_PedidoEjercicioVideo]
GO
ALTER TABLE [dbo].[Tabla_PedidoExplicacion] ADD  CONSTRAINT [DF_Tabla_PedidoExplicacion_id_PedidoExplicacion]  DEFAULT (NEXT VALUE FOR [secuancia_TablaPedidoExplicacion]) FOR [id_PedidoExplicacion]
GO
ALTER TABLE [dbo].[Tabla_Profesor] ADD  CONSTRAINT [DF_Tabla_Profesor_id_Profesor]  DEFAULT (NEXT VALUE FOR [secuancia_Profesor]) FOR [id_Profesor]
GO
ALTER TABLE [dbo].[Tabla_BuquedasEjercicios]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_BuquedasEjercicios_Tabla_Ejercicios] FOREIGN KEY([id_Ejercicio])
REFERENCES [dbo].[Tabla_Ejercicios] ([id_Ejercicio])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_BuquedasEjercicios] CHECK CONSTRAINT [FK_Tabla_BuquedasEjercicios_Tabla_Ejercicios]
GO
ALTER TABLE [dbo].[Tabla_BuquedasEjercicios]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_BuquedasEjercicios_Tabla_TipoIntitucion] FOREIGN KEY([id_TipoInstitucion])
REFERENCES [dbo].[Tabla_TipoIntitucion] ([id_TipoInstitucion])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_BuquedasEjercicios] CHECK CONSTRAINT [FK_Tabla_BuquedasEjercicios_Tabla_TipoIntitucion]
GO
ALTER TABLE [dbo].[Tabla_DatosExtraUsuario]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_DatosExtraUsuario_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_DatosExtraUsuario] CHECK CONSTRAINT [FK_Tabla_DatosExtraUsuario_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_DatosUsuario]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_DatosUsuario_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_DatosUsuario] CHECK CONSTRAINT [FK_Tabla_DatosUsuario_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_DuracionProductos]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_DuracionProductos_Tabla_Empresa] FOREIGN KEY([id_Empresa])
REFERENCES [dbo].[Tabla_Empresa] ([id_Empresa])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_DuracionProductos] CHECK CONSTRAINT [FK_Tabla_DuracionProductos_Tabla_Empresa]
GO
ALTER TABLE [dbo].[Tabla_EnunciadoEjercicios]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_EnunciadoEjercicios_Tabla_Ejercicios] FOREIGN KEY([id_Ejercicio])
REFERENCES [dbo].[Tabla_Ejercicios] ([id_Ejercicio])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_EnunciadoEjercicios] CHECK CONSTRAINT [FK_Tabla_EnunciadoEjercicios_Tabla_Ejercicios]
GO
ALTER TABLE [dbo].[Tabla_MisEjercicios]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_MisEjercicios_Tabla_Ejercicios] FOREIGN KEY([id_Ejercicio])
REFERENCES [dbo].[Tabla_Ejercicios] ([id_Ejercicio])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_MisEjercicios] CHECK CONSTRAINT [FK_Tabla_MisEjercicios_Tabla_Ejercicios]
GO
ALTER TABLE [dbo].[Tabla_MisEjercicios]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_MisEjercicios_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_MisEjercicios] CHECK CONSTRAINT [FK_Tabla_MisEjercicios_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_MisExplicaciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_MisExplicaciones_Tabla_Ejercicios] FOREIGN KEY([id_Ejercicio])
REFERENCES [dbo].[Tabla_Ejercicios] ([id_Ejercicio])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_MisExplicaciones] CHECK CONSTRAINT [FK_Tabla_MisExplicaciones_Tabla_Ejercicios]
GO
ALTER TABLE [dbo].[Tabla_MisExplicaciones]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_MisExplicaciones_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_MisExplicaciones] CHECK CONSTRAINT [FK_Tabla_MisExplicaciones_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_Movimientos]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Movimientos_Tabla_TipoMovimientos] FOREIGN KEY([id_TipoMovimiento])
REFERENCES [dbo].[Tabla_TipoMovimientos] ([id_TipoMovimiento])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_Movimientos] CHECK CONSTRAINT [FK_Tabla_Movimientos_Tabla_TipoMovimientos]
GO
ALTER TABLE [dbo].[Tabla_Movimientos]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Movimientos_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
GO
ALTER TABLE [dbo].[Tabla_Movimientos] CHECK CONSTRAINT [FK_Tabla_Movimientos_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_Ofertas]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Ofertas_Tabla_Empresa] FOREIGN KEY([id_Empresa])
REFERENCES [dbo].[Tabla_Empresa] ([id_Empresa])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_Ofertas] CHECK CONSTRAINT [FK_Tabla_Ofertas_Tabla_Empresa]
GO
ALTER TABLE [dbo].[Tabla_PedidoEjercicioVideo]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_PedidoEjercicioVideo_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_PedidoEjercicioVideo] CHECK CONSTRAINT [FK_Tabla_PedidoEjercicioVideo_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_PedidoExplicacion]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_PedidoExplicacion_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_PedidoExplicacion] CHECK CONSTRAINT [FK_Tabla_PedidoExplicacion_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_PreguntaClientes]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_PreguntaClientes_Tabla_Empresa] FOREIGN KEY([id_Empresa])
REFERENCES [dbo].[Tabla_Empresa] ([id_Empresa])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_PreguntaClientes] CHECK CONSTRAINT [FK_Tabla_PreguntaClientes_Tabla_Empresa]
GO
ALTER TABLE [dbo].[Tabla_TarjetaPrepaga]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_TarjetaPrepaga_Tabla_Empresa] FOREIGN KEY([id_Empresa])
REFERENCES [dbo].[Tabla_Empresa] ([id_Empresa])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_TarjetaPrepaga] CHECK CONSTRAINT [FK_Tabla_TarjetaPrepaga_Tabla_Empresa]
GO
ALTER TABLE [dbo].[Tabla_UbicacionEjercicios]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_UbicacionEjercicios_Tabla_Ejercicios] FOREIGN KEY([id_Ejercicio])
REFERENCES [dbo].[Tabla_Ejercicios] ([id_Ejercicio])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_UbicacionEjercicios] CHECK CONSTRAINT [FK_Tabla_UbicacionEjercicios_Tabla_Ejercicios]
GO
ALTER TABLE [dbo].[Tabla_Usuario]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_Usuario_Tabla_Empresa] FOREIGN KEY([id_Empresa])
REFERENCES [dbo].[Tabla_Empresa] ([id_Empresa])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_Usuario] CHECK CONSTRAINT [FK_Tabla_Usuario_Tabla_Empresa]
GO
ALTER TABLE [dbo].[Tabla_UsuarioCredito]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_UsuarioCredito_Tabla_Usuario] FOREIGN KEY([id_Usuario])
REFERENCES [dbo].[Tabla_Usuario] ([id_Usuario])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_UsuarioCredito] CHECK CONSTRAINT [FK_Tabla_UsuarioCredito_Tabla_Usuario]
GO
ALTER TABLE [dbo].[Tabla_ValorOfertas]  WITH CHECK ADD  CONSTRAINT [FK_Tabla_ValorOfertas_Tabla_Empresa] FOREIGN KEY([id_Empresa])
REFERENCES [dbo].[Tabla_Empresa] ([id_Empresa])
ON UPDATE CASCADE
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[Tabla_ValorOfertas] CHECK CONSTRAINT [FK_Tabla_ValorOfertas_Tabla_Empresa]
GO
/****** Object:  StoredProcedure [dbo].[bloqueCompraEjercicio]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[bloqueCompraEjercicio] (@id_Usuario int,@empresa int, @permisoCompra bit output) as

Begin Try
	
	Declare @calculoAuxiliar decimal(18,2)

	Declare @precioEjercicio decimal(18,2)

	Declare @creditoUsuario decimal (18,2)

	select @precioEjercicio = precioEjercicio from Tabla_DuracionProductos where id_Empresa = @empresa

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioEjercicio

	if @calculoAuxiliar > 0
	  
		Begin

			set @permisoCompra = 1

			return @permisoCompra

		End
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[bloqueCompraExplicacion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[bloqueCompraExplicacion] (@id_Usuario int,@empresa int, @permisoCompra bit output) as

Begin Try
	
	Declare @calculoAuxiliar decimal(18,2)

	Declare @precioExplicacion decimal(18,2)

	Declare @creditoUsuario decimal (18,2)

	select @precioExplicacion = precioExplicacion from Tabla_DuracionProductos where id_Empresa = @empresa

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioExplicacion

	if @calculoAuxiliar > 0
	  
		Begin

			set @permisoCompra = 1

			return @permisoCompra

		End
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[bloqueCompraImpresion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[bloqueCompraImpresion] (@id_Usuario int,@empresa int, @permisoCompra bit output) as

Begin Try
	
	Declare @calculoAuxiliar decimal(18,2)

	Declare @precioImpresion decimal(18,2)

	Declare @creditoUsuario decimal (18,2)

	select @precioImpresion = precioImpresion from Tabla_DuracionProductos where id_Empresa = @empresa

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioImpresion

	if @calculoAuxiliar > 0
	  
		Begin

			set @permisoCompra = 1

			return @permisoCompra

		End
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[bloqueCompraVideo]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[bloqueCompraVideo] (@id_Usuario int,@empresa int, @permisoCompra bit output) as

Begin Try
	
	Declare @calculoAuxiliar decimal(18,2)

	Declare @precioVideo decimal(18,2)

	Declare @creditoUsuario decimal (18,2)

	select @precioVideo = precioVideo from Tabla_DuracionProductos where id_Empresa = @empresa

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioVideo

	if @calculoAuxiliar > 0
	  
		Begin

			set @permisoCompra = 1

			return @permisoCompra

		End
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[cargarCreditoTarjeta]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[cargarCreditoTarjeta] (@id_Usuario int, @empresa int, @cargaCredito decimal(18,2), @resultadoPrestamo bit output) as

Begin Try

	update Tabla_UsuarioCredito set creditoUsuario = creditoUsuario  + @cargaCredito where id_Usuario = @id_Usuario

	Declare @id_Movimiento int

	select @id_Movimiento = Max(id_Movimiento) from Tabla_Movimientos

	if @id_Movimiento is null

		Begin

			set @id_Movimiento = 0

		End

	insert into Tabla_Movimientos (id_Movimiento,id_Usuario,id_TipoMovimiento,debe,haber,fechaMovimiento) values (@id_Movimiento + 1, @id_Usuario, 6, @cargaCredito, null, getdate())

	return @resultadoPrestamo

End try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[cargarCreditoTarjetaPagoParcialSOS]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[cargarCreditoTarjetaPagoParcialSOS] (@id_Usuario int,@cargaCredito decimal(18,2), @empresa int, @resultadoPrestamo decimal(18,2) output) as

Begin Try

	Declare @prestamoReal decimal(18,2)

	Select @prestamoReal = prestamoReal from Tabla_UsuarioCredito where id_Usuario = @id_Usuario
	
	Declare @id_Movimiento int

	Select @id_Movimiento = MAX(id_Movimiento) from Tabla_Movimientos 

	if @id_Movimiento is null

		begin

			set @id_Movimiento = 0

		end

	insert into Tabla_Movimientos(id_Movimiento, id_Usuario, id_tipoMovimiento, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, @id_Usuario,4,@cargaCredito,null, getdate())

	Set @resultadoPrestamo = @cargaCredito - @prestamoReal 

	update Tabla_UsuarioCredito set prestamoReal = (0 - @resultadoPrestamo) where id_Usuario = @id_Usuario

	return @resultadoPrestamo
 
End try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[cargarCreditoTarjetaPagoTotalSOS]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[cargarCreditoTarjetaPagoTotalSOS] (@id_Usuario int,@cargaCredito decimal(18,2), @empresa int, @resultadoPrestamo decimal(18,2) output) as

Begin Try

	Declare @prestamoReal decimal(18,2)

	Select @prestamoReal = prestamoReal from Tabla_UsuarioCredito where id_Usuario = @id_Usuario
	
	Declare @id_Movimiento int

	Select @id_Movimiento = MAX(id_Movimiento) from Tabla_Movimientos 

	if @id_Movimiento is null

		begin

			set @id_Movimiento = 0

		end

	Set @resultadoPrestamo = @cargaCredito - @prestamoReal 

	insert into Tabla_Movimientos(id_Movimiento, id_Usuario, id_tipoMovimiento, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, @id_Usuario,5,0,null, getdate())
	
	update Tabla_UsuarioCredito set prestamoReal = (@cargaCredito - @prestamoReal), prestamoSOS = 0 where id_Usuario = @id_Usuario

	return @resultadoPrestamo
 
End try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[cargarMovimientoCompra]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[cargarMovimientoCompra] (@id_Usuario int,@cargaCredito decimal(18,2), @empresa int,@id_TipoMovimiento int, @resultadoPrestamo decimal(18,2) output) as

Begin Try

	Declare @id_Movimiento int

	Select @id_Movimiento = MAX(id_Movimiento) from Tabla_Movimientos 

	if @id_Movimiento is null

		begin

			set @id_Movimiento = 0

		end

	insert into Tabla_Movimientos(id_Movimiento, id_Usuario, id_tipoMovimiento, debe, haber, fechaMovimiento) values (@id_Movimiento + 1,@id_Usuario, @id_TipoMovimiento, null, @cargaCredito, getdate())
	
	update Tabla_UsuarioCredito set prestamoReal = (0 - @resultadoPrestamo) where id_Usuario = @id_Usuario

	return @resultadoPrestamo
 
End try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[cargarPrestamoSOS]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[cargarPrestamoSOS] (@id_Usuario int, @empresa int,@oferta_1ValorPrestamoSOS decimal(18,2), @resultadoPrestamo int output) as

Begin try

	Declare @PrestamoSOS bit

	Declare @id_Movimiento int
	
	select @id_Movimiento = Max(id_Movimiento) from Tabla_Movimientos 
	
	If @id_Movimiento is null --primer movimiento

		Begin

			set @id_Movimiento = 0

		End

	Insert Into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe,haber,fechaMovimiento) values (@id_Movimiento + 1, 1,  @id_Usuario, @oferta_1ValorPrestamoSOS ,null,getdate()) 
			
	Update Tabla_UsuarioCredito set prestamoSOS = 1, prestamoReal = @oferta_1ValorPrestamoSOS where id_Usuario = @id_Usuario
	
	set @resultadoPrestamo = @oferta_1ValorPrestamoSOS

	return	@resultadoPrestamo
		
End Try

Begin Catch

	set  @resultadoPrestamo = -6

	Return @resultadoPrestamo

End Catch 
GO
/****** Object:  StoredProcedure [dbo].[compraEjerciciosDataListWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[compraEjerciciosDataListWeb](@id_Usuario int, @id_Ejercicio int,@precioCompra decimal(18,2), @empresa int, @resultadoCompra bit output) as

Begin try

	Declare @id_Movimiento int

	declare @calculoAuxiliar decimal(18,2)

	declare @creditoUsuario decimal (18,2)

	Declare @vencimiento int

	Declare @fechaVencimiento datetime

	select @vencimiento = duracionEjercicios from Tabla_DuracionProductos where id_Empresa = @empresa

	set @fechaVencimiento = dateadd (day, @vencimiento,getdate())

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioCompra 
	
	select @id_Movimiento = id_Movimiento from Tabla_Movimientos 

	Declare @id_CompraEjercicioExplicaicones int

	select @id_CompraEjercicioExplicaicones = MAX(id_CompraEjercicioExplicaicones) from Tabla_MisEjercicios

	If exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and explicacion = 1)
	
	Begin
	
		update Tabla_MisEjercicios set  id_Ejercicio = @id_Ejercicio,  ejercicio = 1, venvimiento = @vencimiento where id_CompraEjercicioExplicaicones = @id_CompraEjercicioExplicaicones

	end

	If not exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and explicacion = 1)
	
	Begin
	
		insert into Tabla_MisEjercicios (id_CompraEjercicioExplicaicones,id_Ejercicio,id_Usuario,ejercicio,explicacion,venvimiento,fechaVencimiento) values (@id_CompraEjercicioExplicaicones + 1 , @id_Ejercicio, @id_Usuario,  1, 0, @vencimiento, @fechaVencimiento)
		
	End  
			
	update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

	insert into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, 7, @id_Usuario, null, @precioCompra, getdate())
	
	set @resultadoCompra = 1

	return @resultadoCompra

End try

begin catch

	return -6

end catch


GO
/****** Object:  StoredProcedure [dbo].[compraEjerciciosEnunciadoProfesor]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[compraEjerciciosEnunciadoProfesor](@id_Usuario int, @id_Ejercicio int,@precioCompra decimal(18,2), @empresa int, @resultadoCompra bit output) as

Begin try

	Declare @id_Movimiento int

	declare @calculoAuxiliar decimal(18,2)

	declare @creditoUsuario decimal (18,2)

	Declare @vencimiento int

	Declare @fechaVencimiento datetime

	select @vencimiento = duracionEjercicios from Tabla_DuracionProductos where id_Empresa = @empresa

	set @fechaVencimiento = dateadd (day, @vencimiento,getdate())

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioCompra 
	
	select @id_Movimiento = id_Movimiento from Tabla_Movimientos 

	Declare @id_CompraEjercicioExplicaicones int

	select @id_CompraEjercicioExplicaicones = MAX(id_CompraEjercicioExplicaicones) from Tabla_MisEjercicios

	If exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and explicacion = 1)
	
	Begin
	
		update Tabla_MisEjercicios set  id_Ejercicio = @id_Ejercicio,  ejercicio = 1, venvimiento = @vencimiento where id_CompraEjercicioExplicaicones = @id_CompraEjercicioExplicaicones

	end

	If not exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and explicacion = 1)
	
	Begin
	
		insert into Tabla_MisEjercicios (id_CompraEjercicioExplicaicones,id_Ejercicio,id_Usuario,ejercicio,explicacion,venvimiento,fechaVencimiento) values (@id_CompraEjercicioExplicaicones + 1 , @id_Ejercicio, @id_Usuario,  1, 0, @vencimiento, @fechaVencimiento)
		
	End  
			
	update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

	insert into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, 7, @id_Usuario, null, @precioCompra, getdate())
	
	set @resultadoCompra = 1

	return @resultadoCompra

End try

begin catch

	return -6

end catch


GO
/****** Object:  StoredProcedure [dbo].[compraEjerciciosFichaProfesor]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[compraEjerciciosFichaProfesor](@id_Usuario int, @id_Ejercicio int,@precioCompra decimal(18,2), @empresa int, @resultadoCompra bit output) as

Begin try

	Declare @id_Movimiento int

	declare @calculoAuxiliar decimal(18,2)

	declare @creditoUsuario decimal (18,2)

	Declare @vencimiento int

	Declare @fechaVencimiento datetime

	select @vencimiento = duracionEjercicios from Tabla_DuracionProductos where id_Empresa = @empresa

	set @fechaVencimiento = dateadd (day, @vencimiento,getdate())

	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioCompra 
	
	select @id_Movimiento = id_Movimiento from Tabla_Movimientos 

	Declare @id_CompraEjercicioExplicaicones int

	select @id_CompraEjercicioExplicaicones = MAX(id_CompraEjercicioExplicaicones) from Tabla_MisEjercicios

	If exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and explicacion = 1)
	
	Begin
	
		update Tabla_MisEjercicios set  id_Ejercicio = @id_Ejercicio,  ejercicio = 1, venvimiento = @vencimiento where id_CompraEjercicioExplicaicones = @id_CompraEjercicioExplicaicones

	end

	If not exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and explicacion = 1)
	
	Begin
	
		insert into Tabla_MisEjercicios (id_CompraEjercicioExplicaicones,id_Ejercicio,id_Usuario,ejercicio,explicacion,venvimiento,fechaVencimiento) values (@id_CompraEjercicioExplicaicones + 1 , @id_Ejercicio, @id_Usuario,  1, 0, @vencimiento, @fechaVencimiento)
		
	End  
			
	update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

	insert into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, 7, @id_Usuario, null, @precioCompra, getdate())
	
	set @resultadoCompra = 1

	return @resultadoCompra

End try

begin catch

	return -6

end catch
GO
/****** Object:  StoredProcedure [dbo].[compraExplicacionDataListWeb]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[compraExplicacionDataListWeb](@id_Usuario int, @id_Ejercicio int,@precioCompra decimal(18,2), @empresa int, @resultadoCompra bit output) as

Begin try

	Declare @id_Movimiento int

	declare @calculoAuxiliar decimal(18,2)

	declare @creditoUsuario decimal (18,2)

	Declare @vencimiento int

	Declare @fechaVencimiento datetime

	select @vencimiento = duracionEjercicios from Tabla_DuracionProductos where id_Empresa = @empresa

	set @fechaVencimiento = dateadd (day, @vencimiento,getdate())
	
	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioCompra 
	
	select @id_Movimiento = id_Movimiento from Tabla_Movimientos 

	Declare @id_CompraEjercicioExplicaicones int

	select @id_CompraEjercicioExplicaicones = MAX(id_CompraEjercicioExplicaicones) from Tabla_MisEjercicios

	If exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and ejercicio = 1)
	
	Begin
	
		update Tabla_MisEjercicios set id_Ejercicio = @id_Ejercicio,  explicacion = 1, venvimiento = @vencimiento where id_CompraEjercicioExplicaicones = @id_CompraEjercicioExplicaicones

	end

	If not exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and ejercicio = 1)
	
	Begin
	
		insert into Tabla_MisEjercicios (id_CompraEjercicioExplicaicones,id_Ejercicio,id_Usuario,ejercicio,explicacion,venvimiento,fechaVencimiento) values (@id_CompraEjercicioExplicaicones + 1 , @id_Ejercicio, @id_Usuario,  0, 1, @vencimiento, @fechaVencimiento)
		
	End  
		
	update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

	insert into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, 8, @id_Usuario, null, @precioCompra, getdate())
	
	set @resultadoCompra = 1

	return @resultadoCompra

End try

begin catch

	return -6

end catch


GO
/****** Object:  StoredProcedure [dbo].[compraExplicacionEnunciadoProfesor]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[compraExplicacionEnunciadoProfesor](@id_Usuario int, @id_Ejercicio int,@precioCompra decimal(18,2), @empresa int, @resultadoCompra bit output) as

Begin try

	Declare @id_Movimiento int

	declare @calculoAuxiliar decimal(18,2)

	declare @creditoUsuario decimal (18,2)

	Declare @vencimiento int

	Declare @fechaVencimiento datetime

	select @vencimiento = duracionEjercicios from Tabla_DuracionProductos where id_Empresa = @empresa

	set @fechaVencimiento = dateadd (day, @vencimiento,getdate())
	
	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioCompra 
	
	select @id_Movimiento = id_Movimiento from Tabla_Movimientos 

	Declare @id_CompraEjercicioExplicaicones int

	select @id_CompraEjercicioExplicaicones = MAX(id_CompraEjercicioExplicaicones) from Tabla_MisEjercicios

	If exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and ejercicio = 1)
	
	Begin
	
		update Tabla_MisEjercicios set id_Ejercicio = @id_Ejercicio,  explicacion = 1, venvimiento = @vencimiento where id_CompraEjercicioExplicaicones = @id_CompraEjercicioExplicaicones

	end

	If not exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and ejercicio = 1)
	
	Begin
	
		insert into Tabla_MisEjercicios (id_CompraEjercicioExplicaicones,id_Ejercicio,id_Usuario,ejercicio,explicacion,venvimiento,fechaVencimiento) values (@id_CompraEjercicioExplicaicones + 1 , @id_Ejercicio, @id_Usuario,  0, 1, @vencimiento, @fechaVencimiento)
		
	End  
		
	update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

	insert into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, 8, @id_Usuario, null, @precioCompra, getdate())
	
	set @resultadoCompra = 1

	return @resultadoCompra

End try

begin catch

	return -6

end catch


GO
/****** Object:  StoredProcedure [dbo].[compraExplicacionFichaProfesor]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[compraExplicacionFichaProfesor](@id_Usuario int, @id_Ejercicio int,@precioCompra decimal(18,2), @empresa int, @resultadoCompra bit output) as

Begin try

	Declare @id_Movimiento int

	declare @calculoAuxiliar decimal(18,2)

	declare @creditoUsuario decimal (18,2)

	Declare @vencimiento int

	Declare @fechaVencimiento datetime

	select @vencimiento = duracionEjercicios from Tabla_DuracionProductos where id_Empresa = @empresa

	set @fechaVencimiento = dateadd (day, @vencimiento,getdate())
	
	select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @calculoAuxiliar = @creditoUsuario - @precioCompra 
	
	select @id_Movimiento = id_Movimiento from Tabla_Movimientos 

	Declare @id_CompraEjercicioExplicaicones int

	select @id_CompraEjercicioExplicaicones = MAX(id_CompraEjercicioExplicaicones) from Tabla_MisEjercicios

	If exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and ejercicio = 1)
	
	Begin
	
		update Tabla_MisEjercicios set id_Ejercicio = @id_Ejercicio,  explicacion = 1, venvimiento = @vencimiento where id_CompraEjercicioExplicaicones = @id_CompraEjercicioExplicaicones

	end

	If not exists (select @id_Ejercicio from Tabla_MisEjercicios where id_Ejercicio = @id_Ejercicio and ejercicio = 1)
	
	Begin
	
		insert into Tabla_MisEjercicios (id_CompraEjercicioExplicaicones,id_Ejercicio,id_Usuario,ejercicio,explicacion,venvimiento,fechaVencimiento) values (@id_CompraEjercicioExplicaicones + 1 , @id_Ejercicio, @id_Usuario,  0, 1, @vencimiento, @fechaVencimiento)
		
	End  
		
	update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

	insert into Tabla_Movimientos (id_Movimiento,id_TipoMovimiento, id_Usuario, debe, haber, fechaMovimiento) values (@id_Movimiento + 1, 8, @id_Usuario, null, @precioCompra, getdate())
	
	set @resultadoCompra = 1

	return @resultadoCompra

End try

begin catch

	return -6

end catch


GO
/****** Object:  StoredProcedure [dbo].[consultaCreditoUsuario]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[consultaCreditoUsuario] (@id_Usuario int,@resultadoCredito decimal (10,2) output) as

Begin Try

	Select @resultadoCredito = creditoUsuario from Vista_CreditoUsuarioWeb where id_Usuario = @id_Usuario 

	Return @resultadoCredito

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[consultaPanelControl]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[consultaPanelControl] (@id_Usuario int) as

Begin Try

	Select * from Vista_PanelControlUsuarioWeb where id_Usuario = @id_Usuario

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[consultaPanelMovimiento]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[consultaPanelMovimiento] (@id_Usuario int) as

Begin Try

	Select fechaMovimiento, tipoMovimiento, debe, haber from Vista_PanelSaldoUsuarioWeb where id_Usuario = @id_Usuario order by id_Movimiento desc

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[correoTelefonoExistenteEmpresa]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[correoTelefonoExistenteEmpresa] (@correoUsuario nvarchar(30),@empresa int,@TelefonoUsuario nvarchar(20), @respuestaId_Usuario int output) as

Begin Try	
	
	Set @respuestaId_Usuario = 1
	
	Select @respuestaId_Usuario = id_Usuario from Vista_LogueoUsuariosWeb where (correo = @correoUsuario or telefono = @telefonoUsuario) and id_Empresa = @empresa
	
	if @respuestaId_Usuario is null
		
		Begin
		
			Return @respuestaId_Usuario 
		
		End

End Try

Begin Catch

	Set @respuestaId_Usuario = -6

	Return @respuestaId_Usuario

End Catch


GO
/****** Object:  StoredProcedure [dbo].[descontarDiasBorrar]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[descontarDiasBorrar] as

begin try 

	update Tabla_MisEjercicios set venvimiento = venvimiento - 1
	
	update Tabla_MisExplicaciones set vencimiento = vencimiento - 1

	delete from Tabla_MisEjercicios where venvimiento = 0

	delete from Tabla_MisEjercicios where venvimiento = 0

end try

begin Catch

	return -6

end catch

GO
/****** Object:  StoredProcedure [dbo].[evitarRecompraEjercicio1]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[evitarRecompraEjercicio1](@id_Usuario int, @id_Ejercicio int, @respuestaCompra bit output) as

Begin Try
	
	if exists (select id_Ejercicio from Tabla_MisEjercicios where id_usuario = @id_usuario and ejercicio = 1 and id_Ejercicio = @id_Ejercicio and fechaVencimiento > getdate()) -- para evitar que aparezca dia cero

		Begin

			return -1

		End

		return 1
		
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[evitarRecompraExplicacion1]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[evitarRecompraExplicacion1](@id_Usuario int, @id_Ejercicio int, @respuestaCompra bit output) as

Begin Try
	
	if exists (select id_Ejercicio from Tabla_MisEjercicios where explicacion = 1 and id_Usuario = @id_Usuario and id_Ejercicio = @id_Ejercicio and fechaVencimiento > getdate()) -- para evitar que aparezca dia cero

		Begin

			return -1

		End
		
		return 1

End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[evitarRecompraVideo1]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[evitarRecompraVideo1](@id_Usuario int, @id_Ejercicio int, @respuestaCompra bit output) as

Begin Try
	
	if exists (select id_Ejercicio from Tabla_MisExplicaciones where video = 1 and id_Ejercicio = @id_Ejercicio and fechaVencimiento > getdate() and id_Usuario = @id_Usuario) -- para evitar que aparezca dia cero

		Begin

			return -1

		End
		
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[mensajeCliente]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[mensajeCliente] (@cliente nvarchar(150),@correoCliente nvarchar(150),@empresa nvarchar(150),@preguntaCliente nvarchar(max), @resultadoMensaje int output) as

Begin Try

	Declare @id_PreguntaUsuario int

	set @resultadoMensaje = 1

	Select @id_PreguntaUsuario = Max(id_PreguntaUsuario) from Tabla_PreguntaClientes

	If @id_PreguntaUsuario is null
	
		Begin

			set @id_PreguntaUsuario = 1 

		End

	Insert into Tabla_PreguntaClientes (id_PreguntaUsuario, PreguntaUsuario, id_Empresa, fechaComentario, correoCliente) values (@id_PreguntaUsuario + 1, @preguntaCliente, @empresa, GETDATE() , @correoCliente)  

	return @resultadoMensaje

end Try

Begin Catch

	set @resultadoMensaje = -6

	return @resultadoMensaje 

end Catch

GO
/****** Object:  StoredProcedure [dbo].[modificarPanelControlCambioCorreoTelefono]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[modificarPanelControlCambioCorreoTelefono] (@id_Usuario int, @passwordUsuario nvarchar(10), @correoUsuario nvarchar(30), @telefonoUsuario nvarchar(20), @modeloTelefono nvarchar(20), @skypeUsuario nvarchar(30), @empresa int) as

Begin Try

	if exists (select id_Usuario from Vista_PanelControlUsuarioWeb where (correo = @correoUsuario or telefono = @telefonoUsuario) and id_Empresa = @empresa)

		Begin

			return -1

		End

	Update Tabla_Usuario set correo = @correoUsuario, password = @passwordUsuario where id_Usuario = @id_Usuario

	Update Tabla_DatosUsuario set telefono = @telefonoUsuario , modeloTelefono = @modeloTelefono, skype = @skypeUsuario where id_Usuario = @id_Usuario

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[MostrarEnunciadoImprimible]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[MostrarEnunciadoImprimible] (@id_Ejercicio int) as

begin try 

	select ubicacionImprimible from Tabla_UbicacionEjercicios where id_Ejercicio = @id_Ejercicio

end try

begin catch

	return -6

end catch
GO
/****** Object:  StoredProcedure [dbo].[MostrarEnunciadoVisible]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[MostrarEnunciadoVisible] (@id_Ejercicio int) as

begin try 

	select ubicacionVisible from Tabla_UbicacionEjercicios where id_Ejercicio = @id_Ejercicio

end try

begin catch

	return -6

end catch
GO
/****** Object:  StoredProcedure [dbo].[MostrarRespuestaVideo]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[MostrarRespuestaVideo] (@id_Ejercicio int) as

begin try 

	select ubicacionVideo from Tabla_UbicacionEjercicios where id_Ejercicio = @id_Ejercicio

end try

begin catch

	return -6

end catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaAumentoDias7]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaAumentoDias7] (@id_Usuario int,@empresa int, @respuestaDias int output) as

Begin Try

	Declare @oferta_11ValorAumentoDiasCompras int

	select @oferta_11ValorAumentoDiasCompras = oferta_11ValorAumentoDiasCompras from Tabla_ValorOfertas where id_Empresa = @empresa
	
	set @respuestaDias = @oferta_11ValorAumentoDiasCompras

	return @respuestaDias
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaAumentoDiasTodasCompras8]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaAumentoDiasTodasCompras8] (@id_Usuario int,@empresa int, @respuestaDias int output) as

Begin Try

	Declare @oferta_12ValorAumentoDiasTodasCompras int

	select @oferta_12ValorAumentoDiasTodasCompras = oferta_12ValorAumentoDiasTodasCompras from Tabla_ValorOfertas where id_Empresa = @empresa
	
	set @respuestaDias = @oferta_12ValorAumentoDiasTodasCompras

	return @respuestaDias
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaBonificacionHabitue6]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaBonificacionHabitue6] (@id_Usuario int,@empresa int, @respuestaRecarga int output) as

Begin Try
	
	Declare @compras int
		
	Declare @calculoAuxiliar int
	
	Declare @recargaHabitue decimal(18,2)

	Declare @ejerciciosCompradosHabitue int

	Declare @id_Movimiento int

	Declare @creditoUsuario decimal(18,2)
		
	select @compras = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and (id_TipoMovimiento >= 7 or id_TipoMovimiento <= 20)

	select @id_Movimiento = Max(id_Movimiento) from Tabla_Movimientos

	if @id_Movimiento is null

		Begin

			set @id_Movimiento = 0
		
		End

	select @ejerciciosCompradosHabitue = ejerciciosCompradosHabitue, @recargaHabitue = recargaHabitue from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	if @compras is null

		Begin

			set @compras = 0
		
		End

	set @calculoAuxiliar = (@compras + 1) % @ejerciciosCompradosHabitue

	if @calculoAuxiliar = 0
		
		begin

			insert into Tabla_Movimientos (id_Movimiento,id_Usuario,id_TipoMovimiento,debe,haber,fechaMovimiento) values (@id_Movimiento + 1, @id_Usuario, 21, @recargaHabitue, null,getdate()) 

			select @creditoUsuario = creditoUsuario from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

			set @calculoAuxiliar = @calculoAuxiliar + @recargaHabitue

			update Tabla_UsuarioCredito set creditoUsuario = @calculoAuxiliar where id_Usuario = @id_Usuario

			set @respuestaRecarga = 1

			return @respuestarecarga

		end

		set @respuestarecarga = 0

		return @respuestarecarga
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaCompraEjercicioGratis10]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraVideo9]    Script Date: 24/04/2016 2:49:38 ******/
create proc [dbo].[ofertaCompraEjercicioGratis10] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	set @respuestaValorTipoCompra = '0?7'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaCompraExplicacionGratis10]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraVideo9]    Script Date: 24/04/2016 2:49:38 ******/
CREATE proc [dbo].[ofertaCompraExplicacionGratis10] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	set @respuestaValorTipoCompra = '0?8'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaCompraImpresionGratis10]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraVideo9]    Script Date: 24/04/2016 2:49:38 ******/
create proc [dbo].[ofertaCompraImpresionGratis10] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	set @respuestaValorTipoCompra = '0?10'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaCompraVideoGratis10]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraVideo9]    Script Date: 24/04/2016 2:49:38 ******/
create proc [dbo].[ofertaCompraVideoGratis10] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	set @respuestaValorTipoCompra = '0?9'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraEjercicio9]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDescuentoCompraEjercicio9] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @precioEjercicio decimal(18,2)

	Declare @oferta_13ValorDescuentoCompra int
		
	select @oferta_13ValorDescuentoCompra = oferta_13ValorDescuentoCompra from Tabla_ValorOfertas where id_Empresa = @empresa
	
	select @precioEjercicio = precioEjercicio from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	Declare @calculoAuxiliar decimal(18,2)
		
	set @calculoAuxiliar = @precioEjercicio - ((@precioEjercicio * @oferta_13ValorDescuentoCompra) / 100) 

	set @respuestaValorTipoCompra = CAST(@calculoAuxiliar as nvarchar(20)) + '?7'

	return @respuestaValorTipoCompra
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraExplicacion9]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDescuentoCompraExplicacion9] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @precioExplicacion decimal(18,2)

	Declare @oferta_13ValorDescuentoCompra int
		
	select @oferta_13ValorDescuentoCompra = oferta_13ValorDescuentoCompra from Tabla_ValorOfertas where id_Empresa = @empresa
	
	select @precioExplicacion = precioExplicacion from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	Declare @calculoAuxiliar decimal(18,2)
		
	set @calculoAuxiliar = @precioExplicacion - ((@precioExplicacion * @oferta_13ValorDescuentoCompra) / 100) 

	set @respuestaValorTipoCompra = CAST(@calculoAuxiliar as nvarchar(20)) + '?8'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraImpresion9]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDescuentoCompraImpresion9] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @precioImpresion decimal(18,2)

	Declare @oferta_13ValorDescuentoCompra int
		
	select @oferta_13ValorDescuentoCompra = oferta_13ValorDescuentoCompra from Tabla_ValorOfertas where id_Empresa = @empresa
	
	select @precioImpresion = precioImpresion from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	Declare @calculoAuxiliar decimal(18,2)
		
	set @calculoAuxiliar = @precioImpresion - ((@precioImpresion * @oferta_13ValorDescuentoCompra) / 100) 

	set @respuestaValorTipoCompra = CAST(@calculoAuxiliar as nvarchar(20)) + '?10'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoCompraVideo9]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDescuentoCompraVideo9] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @precioVideo decimal(18,2)

	Declare @oferta_13ValorDescuentoCompra int
		
	select @oferta_13ValorDescuentoCompra = oferta_13ValorDescuentoCompra from Tabla_ValorOfertas where id_Empresa = @empresa
	
	select @precioVideo = precioVideo from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	Declare @calculoAuxiliar decimal(18,2)
		
	set @calculoAuxiliar = @precioVideo - ((@precioVideo * @oferta_13ValorDescuentoCompra) / 100) 

	set @respuestaValorTipoCompra = CAST(@calculoAuxiliar as nvarchar(20)) + '?9'

	return @respuestaValorTipoCompra

				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoSegundoProductoEjercicio5]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaDescuentoSegundoProductoEjercicio5] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @calculoAuxiliarPrecio decimal(18,2)

	Declare @precioEjercicio decimal(18,2)

	Declare @fechaMovimiento date

	Declare @oferta_9ValorDescuentoSegundo decimal (18,2)

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 7 or id_TipoMovimiento = 17)

	select @precioEjercicio = precioEjercicio from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	select @oferta_9ValorDescuentoSegundo = oferta_9ValorDescuentoSegundo from Tabla_ValorOfertas where id_Empresa = @empresa

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin

			set @calculoAuxiliarPrecio = @precioEjercicio - ((@precioEjercicio * @oferta_9ValorDescuentoSegundo) / 100)
			
			set @respuestaValorTipoCompra = CAST(@calculoAuxiliarPrecio as nvarchar(20)) + '0?17'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioEjercicio as nvarchar(20)) + '?7'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoSegundoProductoExplicacion5]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaDescuentoSegundoProductoExplicacion5] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @calculoAuxiliarPrecio decimal(18,2)

	Declare @precioExplicacion decimal(18,2)

	Declare @fechaMovimiento date

	Declare @oferta_9ValorDescuentoSegundo decimal (18,2)

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 8 or id_TipoMovimiento = 18)

	select @precioExplicacion = precioExplicacion from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	select @oferta_9ValorDescuentoSegundo = oferta_9ValorDescuentoSegundo from Tabla_ValorOfertas where id_Empresa = @empresa

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin

			set @calculoAuxiliarPrecio = @precioExplicacion - ((@precioExplicacion * @oferta_9ValorDescuentoSegundo) / 100)
			
			set @respuestaValorTipoCompra = CAST(@calculoAuxiliarPrecio as nvarchar(20)) + '0?18'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioExplicacion as nvarchar(20)) + '?8'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoSegundoProductoImpresion5]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaDescuentoSegundoProductoImpresion5] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @calculoAuxiliarPrecio decimal(18,2)

	Declare @precioImpresion decimal(18,2)

	Declare @fechaMovimiento date

	Declare @oferta_9ValorDescuentoSegundo decimal (18,2)

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 10 or id_TipoMovimiento = 19)

	select @precioImpresion = precioImpresion from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	select @oferta_9ValorDescuentoSegundo = oferta_9ValorDescuentoSegundo from Tabla_ValorOfertas where id_Empresa = @empresa

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin

			set @calculoAuxiliarPrecio = @precioImpresion - ((@precioImpresion * @oferta_9ValorDescuentoSegundo) / 100)
			
			set @respuestaValorTipoCompra = CAST(@calculoAuxiliarPrecio as nvarchar(20)) + '0?19'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioImpresion as nvarchar(20)) + '?10'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDescuentoSegundoProductoVideo5]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaDescuentoSegundoProductoVideo5] (@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @calculoAuxiliarPrecio decimal(18,2)

	Declare @precioVideo decimal(18,2)

	Declare @fechaMovimiento date

	Declare @oferta_9ValorDescuentoSegundo decimal (18,2)

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 9 or id_TipoMovimiento = 20)

	select @precioVideo = precioVideo from Tabla_DuracionProductos where id_Empresa = @empresa 
	
	select @oferta_9ValorDescuentoSegundo = oferta_9ValorDescuentoSegundo from Tabla_ValorOfertas where id_Empresa = @empresa

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin

			set @calculoAuxiliarPrecio = @precioVideo - ((@precioVideo * @oferta_9ValorDescuentoSegundo) / 100)
			
			set @respuestaValorTipoCompra = CAST(@calculoAuxiliarPrecio as nvarchar(20)) + '0?20'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioVIdeo as nvarchar(20)) + '?9'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDosXUno2]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDosXUno2](@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @precioEjercicio decimal(18,2)

	Declare @fechaMovimiento date

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento >= 7 or id_Movimiento <= 10 or id_Movimiento = 12) 

	select @precioEjercicio = precioEjercicio from Tabla_DuracionProductos where id_Empresa = @empresa 

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin
			
			set @respuestaValorTipoCompra = '0?12'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioEjercicio as nvarchar(20)) + '?7'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDosXUnoIgualProductoEjercicio3]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDosXUnoIgualProductoEjercicio3](@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @precioEjercicio decimal(18,2)

	Declare @fechaMovimiento date

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 7 or id_TipoMovimiento = 13)

	select @precioEjercicio = precioEjercicio from Tabla_DuracionProductos where id_Empresa = @empresa 

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin
			
			set @respuestaValorTipoCompra = '0?13'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioEjercicio as nvarchar(20)) + '?7'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDosXUnoIgualProductoExplicacion3]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDosXUnoIgualProductoExplicacion3](@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @precioExplicacion decimal(18,2)

	Declare @fechaMovimiento date

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 8 or id_TipoMovimiento = 14)

	select @precioExplicacion = precioExplicacion from Tabla_DuracionProductos where id_Empresa = @empresa 

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin
			
			set @respuestaValorTipoCompra = '0?14'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioExplicacion as nvarchar(20)) + '?8'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDosXUnoIgualProductoImpresion3]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaDosXUnoIgualProductoImpresion3](@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @precioImpresion decimal(18,2)

	Declare @fechaMovimiento date

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 10 or id_TipoMovimiento = 15)

	select @precioImpresion = precioImpresion from Tabla_DuracionProductos where id_Empresa = @empresa 

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin
			
			set @respuestaValorTipoCompra = '0?15'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioImpresion as nvarchar(20)) + '?10'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaDosXUnoIgualProductoVideos3]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaDosXUnoIgualProductoVideos3](@id_Usuario int,@empresa int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	Declare @comprasHoy int
		
	Declare @calculoAuxiliar int

	Declare @precioVideo decimal(18,2)

	Declare @fechaMovimiento date

	set @fechaMovimiento = Getdate()
		
	select @comprasHoy = count(id_Usuario) from Tabla_Movimientos where id_Usuario = @id_Usuario and fechaMovimiento = @fechaMovimiento and (id_TipoMovimiento = 9 or id_TipoMovimiento = 16)

	select @precioVideo = precioVideo from Tabla_DuracionProductos where id_Empresa = @empresa 

	if @comprasHoy is null

		Begin

			set @comprasHoy = 0
		
		End

	set @calculoAuxiliar = (@comprasHoy + 1) % 2

	if @calculoAuxiliar = 0
		
		begin
			
			set @respuestaValorTipoCompra = '0?16'

			return @respuestaValorTipoCompra

		end
		
		set @respuestaValorTipoCompra = CAST(@precioVideo as nvarchar(20)) + '?9'

		return @respuestaValorTipoCompra
		
		return 
				
End Try

Begin Catch

	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaGratis4]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[ofertaGratis4](@id_Usuario int, @respuestaValorTipoCompra nvarchar(10) output) as

Begin Try
	
	set @respuestaValorTipoCompra = '0?12'

	return @respuestaValorTipoCompra

End Try

Begin Catch
	
	return -6

End Catch
GO
/****** Object:  StoredProcedure [dbo].[ofertaRegistro]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[ofertaRegistro] (@id_Usuario int, @empresa int, @respuestaOferta bit output) as

	Declare @oferta_2ValorRegistro decimal(8,2)

	Declare @oferta_2Registro bit

	Declare @id_Movimiento int
	
	select @oferta_2Registro = oferta_2Registro from Tabla_Ofertas where id_Empresa = @empresa -- oferta al registrarse
			
	If @oferta_2Registro = 1
	
		Begin
		
			select @oferta_2ValorRegistro = oferta_2ValorRegistro from Tabla_ValorOfertas where id_Empresa = @empresa 
						
			Insert Into Tabla_UsuarioCredito (id_Usuario, creditoUsuario, prestamoReal, prestamoSOS) values (@id_Usuario, @oferta_2ValorRegistro,0,0)

			select @id_Movimiento = max(id_Movimiento) from Tabla_Movimientos
			
			if @id_Movimiento is null

				Begin

					set @id_Movimiento = 0

				End
			
			Insert Into Tabla_Movimientos (id_Movimiento,fechaMovimiento, id_TipoMovimiento,debe,haber, id_Usuario) values (@id_Movimiento +1, GETDATE(), 2, @oferta_2ValorRegistro,null,@id_Usuario)
		
			set @respuestaOferta = 1

			return @respuestaOferta

		End 
	
		Insert Into Tabla_UsuarioCredito (id_Usuario, creditoUsuario, prestamoReal, prestamoSOS) values (@id_Usuario, 0,0,0)

		set @respuestaOferta = 1

		return @respuestaOferta
	
	
	
GO
/****** Object:  StoredProcedure [dbo].[pedidoPrestamoSOS]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[pedidoPrestamoSOS] (@id_Usuario int, @empresa int, @resultadoPrestamo decimal(18,2) output) as

Begin Try

	Declare @prestamoReal decimal(18,2)

	Declare @prestamoSOS bit

	Declare @oferta_1PrestamoSOS bit

	Declare @oferta_1ValorPrestamoSOS decimal(18,2)

	select @oferta_1PrestamoSOS = oferta_1PrestamoSOS from Tabla_Ofertas where id_Empresa = @empresa

	if @oferta_1PrestamoSOS = 1

		begin

			Select  @oferta_1ValorPrestamoSOS = oferta_1ValorPrestamoSOS from Tabla_ValorOfertas where id_Empresa = @empresa
		end
		
	set @resultadoPrestamo = @oferta_1ValorPrestamoSOS

	return @resultadoPrestamo

End try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[prestamoRealPedido]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[prestamoRealPedido] (@id_Usuario int, @empresa int, @resultadoPrestamoReal decimal(18,2) output) as

Begin Try

	Declare @prestamoReal decimal(18,2)

	Select @prestamoReal = prestamoReal from Tabla_UsuarioCredito where id_Usuario = @id_Usuario

	set @resultadoPrestamoReal = @prestamoReal

	return @resultadoPrestamoReal

End try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[resultadoDatalistTitulosEjercicioBusqueda]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[resultadoDatalistTitulosEjercicioBusqueda] (@profesorEjercicio nvarchar(150),@anoEjercicio nvarchar(150),@colegioEjercicio nvarchar(150),@materiaEjercicio nvarchar(150), @temaEjercicio nvarchar(150)) as

Begin Try
	
	select id_Ejercicio,Titulo from Tabla_Ejercicios where id_Ejercicio in (select id_Ejercicio from Tabla_BuquedasEjercicios where contains (etiquetaProfesor,@profesorEjercicio) and contains (etiquetaAno,@anoEjercicio) and contains (etiquetaColegio,@colegioEjercicio) and contains (etiquetaMateria,@materiaEjercicio) and contains (etiquetaTema,@temaEjercicio)) order by id_Ejercicio desc

end Try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[resultadoDatalistTitulosEjercicioBusquedaPaginado]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[resultadoDatalistTitulosEjercicioBusquedaPaginado] (@profesorEjercicio nvarchar(150),@anoEjercicio nvarchar(150),@colegioEjercicio nvarchar(150),@materiaEjercicio nvarchar(150), @temaEjercicio nvarchar(150)) as

Begin Try

	Declare @Cantidad int

	select @Cantidad = COUNT(id_Ejercicio) from Tabla_Ejercicios where id_Ejercicio in (select id_Ejercicio from Tabla_BuquedasEjercicios where contains (etiquetaProfesor,@profesorEjercicio) and contains (etiquetaAno,@anoEjercicio) and contains (etiquetaColegio,@colegioEjercicio) and contains (etiquetaMateria,@materiaEjercicio) and contains (etiquetaTema,@temaEjercicio)) 

	return @Cantidad

end Try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[resultadoDatalistTitulosEjercicioCompleta]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[resultadoDatalistTitulosEjercicioCompleta]  as

Begin Try
	
	select id_Ejercicio,Titulo from Tabla_Ejercicios order by id_Ejercicio desc

end Try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[resultadoDatalistTitulosEjercicioCompletaPaginado]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[resultadoDatalistTitulosEjercicioCompletaPaginado] as

Begin Try

	Declare @Cantidad int

	select @Cantidad = COUNT(id_Ejercicio) from Tabla_Ejercicios 

	return @Cantidad

end Try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[resultadoDatalistTitulosEjercicioEjercicios]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[resultadoDatalistTitulosEjercicioEjercicios] (@enunciadoEjercicio_1 nvarchar(150),@enunciadoEjercicio_2 nvarchar(150)) as

Begin Try
		
	select id_Ejercicio from Tabla_EnunciadoEjercicios where contains (enunciadoLimpio,@enunciadoEjercicio_1) or contains (enunciadoLimpio,@enunciadoEjercicio_2) order by id_Ejercicio desc
	
end Try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[resultadoMostrarEnunciado]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[resultadoMostrarEnunciado] (@Enunciado_1 nvarchar(150),@Enunciado_2 nvarchar(150)) as

Begin Try
	
	select id_Ejercicio from Tabla_EnunciadoEjercicios where contains (enunciadoLimpio,@Enunciado_1) or contains (enunciadoLimpio,@Enunciado_2) order by id_Ejercicio desc

end Try

Begin Catch

	return -6

end Catch
GO
/****** Object:  StoredProcedure [dbo].[sinCreditoEjercicio]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[sinCreditoEjercicio] (@id_Usuario int, @empresa int, @usuarioCredito decimal(18,2), @respuestaCompra bit output) as

Begin Try

	Declare @precioEjercicio decimal(18,2)

	Select @precioEjercicio = precioEjercicio from Tabla_DuracionProductos where id_Empresa = @empresa

	if @precioEjercicio < @usuarioCredito

		Begin

			set @respuestaCompra = 1

			return @respuestaCompra

		End

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[sinCreditoExplicacion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[sinCreditoExplicacion] (@id_Usuario int, @empresa int, @usuarioCredito decimal(18,2), @respuestaCompra bit output) as

Begin Try

	Declare @precioExplicacion decimal(18,2)

	Select @precioExplicacion = precioExplicacion from Tabla_DuracionProductos where id_Empresa = @empresa

	if @precioExplicacion < @usuarioCredito

		Begin

			set @respuestaCompra = 1

			return @respuestaCompra

		End

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[sinCreditoImpresion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[sinCreditoImpresion] (@id_Usuario int, @empresa int, @usuarioCredito decimal(18,2), @respuestaCompra bit output) as

Begin Try

	Declare @precioImpresion decimal(18,2)

	Select @precioImpresion = precioImpresion from Tabla_DuracionProductos where id_Empresa = @empresa

	if @precioiMPRESION < @usuarioCredito

		Begin

			set @respuestaCompra = 1

			return @respuestaCompra

		End

End Try

Begin Catch

	set @respuestaCompra = -6

	return @respuestaCompra

End Catch

GO
/****** Object:  StoredProcedure [dbo].[sinCreditoVideo]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create proc [dbo].[sinCreditoVideo] (@id_Usuario int, @empresa int, @usuarioCredito decimal(18,2), @respuestaCompra bit output) as

Begin Try

	Declare @precioVideo decimal(18,2)

	Select @precioVideo = precioVideo from Tabla_DuracionProductos where id_Empresa = @empresa

	if @precioVideo < @usuarioCredito

		Begin

			set @respuestaCompra = 1

			return @respuestaCompra

		End

End Try

Begin Catch

	return -6

End Catch

GO
/****** Object:  StoredProcedure [dbo].[usuarioActivacion]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[usuarioActivacion] (@usuario nvarchar(10), @activacionUsuario int, @respuestaId_Usuario int output) as

Begin Try	
	
	Set @respuestaId_Usuario = -1

	Select @respuestaId_Usuario = id_Usuario from Vista_ActivacionUsuarioWeb where nick = @usuario and codigoBloqueo = @activacionUsuario

	Update Tabla_DatosExtraUsuario set bloqueoUsuario = 1,codigoBloqueo = null  where id_Usuario = @respuestaId_Usuario

	if @respuestaId_Usuario is null
		
		Begin
		
			Return @respuestaId_Usuario 
		
		End

		Return @respuestaId_Usuario

End Try

Begin Catch

	Set @respuestaId_Usuario = -6

	Return @respuestaId_Usuario

End Catch


GO
/****** Object:  StoredProcedure [dbo].[usuarioContrasena]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[usuarioContrasena] (@correoUsuario nvarchar(30), @telefonoUsuario nvarchar(20), @usuario nvarchar(10),@empresa int, @respuestaContrasena nvarchar(10) output) as

Begin Try 

	if @correoUsuario is not null

		Begin

			select @respuestaContrasena = password from Vista_RecuperarContraseñaWeb where correo = @correoUsuario and bloqueoUsuario = 0 and id_Empresa = @empresa

			if @respuestaContrasena is null

				Begin 
				
					set @respuestaContrasena = -1

					return @respuestaContrasena

				End

			return @respuestaContrasena

		end

	if @telefonoUsuario is not null

		Begin

			select @respuestaContrasena = password from Vista_RecuperarContraseñaWeb where telefono = @telefonoUsuario and bloqueoUsuario = 1 and id_Empresa = @empresa

			if @respuestaContrasena is null

				Begin 
				
					set @respuestaContrasena = -1

					return @respuestaContrasena

				End

			return @respuestaContrasena

		End

	if @usuario is not null

		Begin

			select @respuestaContrasena = password from Vista_RecuperarContraseñaWeb where nick = @usuario and bloqueoUsuario = 1 and id_Empresa = @empresa

			if @respuestaContrasena is null

				Begin 
				
					set @respuestaContrasena = -1

					return @respuestaContrasena

				End

			return @respuestaContrasena

		End

End Try

Begin Catch

	set @respuestaContrasena = -6

	return @respuestaContrasena

End Catch



GO
/****** Object:  StoredProcedure [dbo].[usuarioExiste]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[usuarioExiste] (@usuario nvarchar(10), @respuestaId_Usuario int output) as

Begin Try	
	
	Set @respuestaId_Usuario = -1
	
	Select @respuestaId_Usuario = id_Usuario from Vista_LogueoUsuariosWeb where nick = @usuario
	
	if @respuestaId_Usuario is null
		
		Begin
		
			Return @respuestaId_Usuario 
		
		End

End Try

Begin Catch

	Set @respuestaId_Usuario = -6

	Return @respuestaId_Usuario

End Catch


GO
/****** Object:  StoredProcedure [dbo].[usuarioLogueado]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[usuarioLogueado] (@usuario nvarchar(10),@passwordUsuario nvarchar(10),@respuestaId_Usuario int output) as

Begin Try	
	
	Set @respuestaId_Usuario = -1
	
	Select @respuestaId_Usuario = id_Usuario from Vista_LogueoUsuariosWeb where nick = @usuario and password = @passwordUsuario collate Latin1_General_CS_AS and bloqueoUsuario = 0
	
	if @respuestaId_Usuario is null
		
		Begin
		
			Return @respuestaId_Usuario 
		
		End

End Try

Begin Catch

	Set @respuestaId_Usuario = -6

	Return @respuestaId_Usuario

End Catch


GO
/****** Object:  StoredProcedure [dbo].[usuarioRegistrado]    Script Date: 30/04/2016 1:18:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[usuarioRegistrado] (@usuario nvarchar(10),@passwordUsuario nvarchar(10), @correoUsuario nvarchar(30), @telefonoUsuario nvarchar(20), @empresa int, @ipAddress nvarchar(20), @codigoActivacion int, @respuestaRegistrado int output) as

Begin Try	

	Declare @id_Usuario int

	Set @respuestaRegistrado = -1

	Declare @id_Movimiento int

	Select @id_Usuario = MAX(id_Usuario) from Tabla_Usuario

	if @id_Usuario is null -- aclaracion necesaria cuando es el primero
		
		Begin

			Set @id_Usuario = 0

		End
	
	Insert Into Tabla_Usuario (id_Usuario,nick,password,correo,id_Empresa) values (@id_Usuario + 1, @usuario,@passwordUsuario,@correoUsuario,@empresa)
	
	select @id_Movimiento = max(id_Movimiento) from Tabla_Movimientos

	if @id_Movimiento is null

		Begin

			set @id_Movimiento = 0

		End

	Insert Into Tabla_DatosUsuario (id_Usuario,telefono,modeloTelefono,skype) values (@id_Usuario + 1, @telefonoUsuario, null, null)

	Insert Into Tabla_DatosExtraUsuario (id_Usuario ,ipAddress, bloqueoUsuario, ofertaProximaCarga, codigoBloqueo) values (@id_Usuario + 1, @ipAddress, 0, 0, @codigoActivacion)
	
	Set @respuestaRegistrado = 1
	
	Return @respuestaRegistrado

End Try

Begin Catch
	
	Set @respuestaRegistrado = -6

	Return @respuestaRegistrado

End Catch


GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Usuario"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 136
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 1
         End
         Begin Table = "Tabla_Empresa"
            Begin Extent = 
               Top = 87
               Left = 286
               Bottom = 183
               Right = 495
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_DatosExtraUsuario"
            Begin Extent = 
               Top = 0
               Left = 529
               Bottom = 150
               Right = 738
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_ActivacionUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_ActivacionUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_BusquedaEjercicios"
            Begin Extent = 
               Top = 9
               Left = 337
               Bottom = 192
               Right = 546
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_Ejercicios"
            Begin Extent = 
               Top = 6
               Left = 46
               Bottom = 102
               Right = 255
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_BusquedaEjercicioDatalistWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_BusquedaEjercicioDatalistWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Usuario"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 136
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_UsuarioCredito"
            Begin Extent = 
               Top = 6
               Left = 285
               Bottom = 136
               Right = 494
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_CreditoUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_CreditoUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[55] 4[17] 2[10] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Usuario"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 158
               Right = 314
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_DatosExtraUsuario"
            Begin Extent = 
               Top = 6
               Left = 403
               Bottom = 162
               Right = 621
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_DatosUsuario"
            Begin Extent = 
               Top = 131
               Left = 344
               Bottom = 261
               Right = 553
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_LogueoUsuariosWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_LogueoUsuariosWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Ejercicios"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 102
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_UbicacionEjercicios"
            Begin Extent = 
               Top = 6
               Left = 285
               Bottom = 136
               Right = 494
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 12
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_MostrarEnunciadoDatalistWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_MostrarEnunciadoDatalistWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[49] 4[13] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Ejercicios"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 102
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_UbicacionEjercicios"
            Begin Extent = 
               Top = 6
               Left = 532
               Bottom = 136
               Right = 741
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_EnunciadoEjercicios"
            Begin Extent = 
               Top = 107
               Left = 295
               Bottom = 221
               Right = 504
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_MostrarListadoDeEjercicios'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_MostrarListadoDeEjercicios'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Usuario"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 154
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_DatosUsuario"
            Begin Extent = 
               Top = 6
               Left = 285
               Bottom = 154
               Right = 494
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_PanelControlUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_PanelControlUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[52] 4[9] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Movimientos"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 161
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 1
         End
         Begin Table = "Tabla_Usuario"
            Begin Extent = 
               Top = 0
               Left = 327
               Bottom = 146
               Right = 536
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_TipoMovimientos"
            Begin Extent = 
               Top = 155
               Left = 323
               Bottom = 251
               Right = 532
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_PanelSaldoUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_PanelSaldoUsuarioWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[47] 4[15] 2[21] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Tabla_Usuario"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 159
               Right = 247
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_DatosExtraUsuario"
            Begin Extent = 
               Top = 6
               Left = 285
               Bottom = 153
               Right = 494
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Tabla_DatosUsuario"
            Begin Extent = 
               Top = 6
               Left = 532
               Bottom = 136
               Right = 741
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_RecuperarContraseñaWeb'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=1 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'Vista_RecuperarContraseñaWeb'
GO
